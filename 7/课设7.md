## 实验七

#### 计科21-2    2021011587    吴维皓



### 题目一

tcmalloc是由Google开发的一种内存分配器，用于管理内存的分配和释放。其独特的内存管理结构以及高效的分配和释放机制使其在性能和内存碎片方面优于ptmalloc



**tcmalloc的内存管理结构：**

- 线程缓存层
  - 每个线程拥有自己的本地内存缓存，专用于小对象的分配和释放。
  - 小对象通常指的是不超过32KB的内存块

- 中心缓存层
  - 用于存储大对象，即大小超过32KB的内存块
  - 多线程可访问中心缓存，但为了最小化锁争用，tcmalloc采用了一种智能的分级锁机制，将中心缓存细分为多个子缓存，每个子缓存拥有独立的锁
- 页堆层
  - 管理大的页堆，通常为2MB大小
  - 负责将内存分配给线程缓存或中心缓存，以满足不同大小的内存请求
- Span和Block
  - Span是一组相邻的页，用于存储中等大小的对象
  - Block是Span中的最小分配单位



**为何tcmalloc在多线程环境中更高效：**

- 独立的Thread-Caching层：

  - 每个线程拥有私有的本地内存缓存，显著减少了线程之间的竞争和锁争用。

  - 相比之下，ptmalloc中的全局数据结构可能引发频繁的锁争用，影响性能。

- 细粒度的锁策略：

  - tcmalloc采用分级锁机制，将中心缓存分割为多个子缓存，每个子缓存配备独立的锁。

  - 这种设计降低了锁的粒度，有效减少了锁争用，提高了并发性。

- Thread-Caching层的效率：

  - tcmalloc通过线程本地缓存提高了小对象分配和释放的效率，避免了线程之间频繁的共享操作。

  - 相较之下，ptmalloc在处理小对象时可能需要更多的全局共享操作，导致性能下降。

- 内存碎片优化：

  - tcmalloc通过巧妙的Span和Block结构，有效减少了内存碎片的生成。

  - 在多线程环境中，tcmalloc更为高效地管理内存，减少了碎片的产生。
